#- when: django_current_pod_name is undefined
#  block:
#    - name: "fetch image_tag if undefined"
#      when: image_tag is undefined or not image_tag
#      include_tasks: "tasks/fetch-current-image-tag.yaml"
#
#    - name: "wait for existing django container to {{ command_description }}"
#      shell: >
#        {{ kubectl_command }} -n {{ k8s_namespace }} get pod -l "application={{ application }},component=django,image_tag={{ stateless_services_image_tag }}" -o jsonpath='{.items[0].metadata.name}'
#      register: django_pod_name
#      until: django_pod_name.rc == 0
#      changed_when: false
#
#    - name: "wait for running django container to {{ command_description }}"
#      shell: >
#        {{ kubectl_command }} -n {{ k8s_namespace }} exec {{ django_pod_name.stdout }} -c django -- manage help
#      register: help_result
#      until: help_result.rc == 0
#      changed_when: false
#
#    - name: "set django container identifier for future manage commands"
#      set_fact:
#        django_current_pod_name: "{{ django_pod_name.stdout }}"
#
#- name: "{{ command_description }}"
#  shell: >
#    {{ kubectl_command }} -n {{ k8s_namespace }} exec {{ django_current_pod_name }} -c django -- {{ command }}
#  register: "last_manage_result"
#  changed_when: "(changed_when_missing_from_stdout is not defined and changed_when_missing_from_stderr is not defined and (changed_when_never is not defined or not changed_when_never)) or ((changed_when_missing_from_stdout is defined) and (last_manage_result.stdout is not search(changed_when_missing_from_stdout))) or ((changed_when_missing_from_stderr is defined) and (last_manage_result.stderr is not search(changed_when_missing_from_stderr)))"
